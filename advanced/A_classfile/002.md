# 造轮子

## 有的没的

我一直有这样一个想法，就是希望自己讲出的东西，能够容易理解，便于记忆。我对于武侠小说里的“武功”记忆起来比较亲切。就比如说，张无忌练《乾坤大挪移》，一共有七层，我却总是念念不忘。

对于“一共举三个例子来说明问题，每个例子怎么怎么样”，这样的话，我总是觉得“无感”，记忆起来觉得不方便，时间久了，也就忘了大部分。我按照我的方式，就把这三个例子描述成一套武功。



- [ ] 这套武功分成三层
  - [ ] 第一层心法：无中生有。（或称为，道生一）
  - [ ] 第二层心法：一生二，二生三。
  - [ ] 第三层心法：三生万物。

姑且给这套武功取个名字叫《造轮子之生万物》。

当然，不同的人，有不同的记忆方法。每个人选择自己合适的记忆方法就好了。如果诸位读者觉得我讲的不合理，就当我是胡说八道好了。

> 《道德经》第40章：“天下万物生于有，有生于无。”  
> 《道德经》第42章：“道生一，一生二，二生三，三生万物。”

第一层心法：无中生有。讲究的是从“没有”到“有”的一个过程，也就是从0到1的过程。“有”和“无”在这里指的是文件的存储格式。在此之前是“无”的状态，也就是并没有一种存储格式存在；在此之后是“有”的状态，也就是我们自己定义一套存储格式。

第二层心法：一生二，二生三。讲究的是，我们在自定义的存储格式上进行有限次的变化，让存储格式变得稍微复杂。

第三层心法：三生万物。讲究的是，我们在自定义的存储格式上可以进行无限次的变化，以满足实际应用场景当中的要求。

## 第一层内功心法：无中生有

SampleA.java

在内存上，`IdAndName`类的实例对象存储结构如下表，

| Java数据类型 | 字段名 | 内存占用空间（字节）       |
| -------- | ------ | ---------------------- |
| `int`    | `id`   | `4`个字节 或 `u4`                    |
| `String` | `name` | 不确定（随内容而变化） |

序列化的过程，就是将内存中的数据向硬盘中的数据进行转换的过程。现在已经有了内存中的对象，接下来就是向硬盘进行数据转换了，这个时候就需要我们定义一种数据格式了。

在硬盘上，我们定义一种文件存储结构如下表，暂且将这种结构称为`user_info`。

| 数据结构 | 名称     | 数量     |
| -------- | -------- | -------- |
| `u1`     | `index`  | `1`      |
| `u2`     | `length` | `1`      |
| `u1`     | `bytes`  | `length` |

达到一个什么目标算是学会了呢？

## 第二层内功心法：一生二，二生三

SampleB

| 数据结构    | 名称         | 数量         |
| ----------- | ------------ | ------------ |
| `u2`        | `user_count` | `1`          |
| `user_info` | `users`      | `user_count` |

其中，`user_info` 结构如下：

| 数据结构 | 名称     | 数量     |
| -------- | -------- | -------- |
| `u1`     | `index`  | `1`      |
| `u2`     | `length` | `1`      |
| `u1`     | `bytes`  | `length` |

SampleC

| 数据结构    | 名称         | 数量         |
| ----------- | ------------ | ------------ |
| `u2`        | `talker_count` | `1`          |
| `talker_info` | `talkers`      | `talker_count` |
| `u2`        | `say_count` | `1`          |
| `say_info` | `says`      | `say_count` |

其中，`talker_info` 结构如下：

| 数据结构 | 名称     | 数量     |
| -------- | -------- | -------- |
| `u1`     | `index`  | `1`      |
| `u2`     | `length` | `1`      |
| `u1`     | `bytes`  | `length` |

其中，`say_info` 结构如下：

| 数据结构 | 名称     | 数量     |
| -------- | -------- | -------- |
| `u1`     | `index`  | `1`      |
| `u2`     | `length` | `1`      |
| `u1`     | `bytes`  | `length` |

## 第三层内功心法：三生万物

SampleD

| 数据结构    | 名称         | 数量         |
| ----------- | ------------ | ------------ |
| `u4`        | `magic_number` | `1`          |
| `u2` | `year` | `1` |
| `u1`       | `month` | `1`          |
| `u1` | `day`   | `1` |
| `u2`        | `talker_count` | `1`          |
| `talker_info` | `talkers`      | `talker_count` |
| `u2`        | `say_count` | `1`          |
| `say_info` | `says`      | `say_count` |


## 复习与总结



